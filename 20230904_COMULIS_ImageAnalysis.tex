% Compile with:
% latexmk -pdf -pvc -interaction=nonstopmode *ImageAnalysis.tex
%\documentclass[aspectratio=169,draft]{beamer}
\documentclass[aspectratio=169]{beamer}

\usetheme{UniBern}

\title{\uct and image analysis}
\author{David Haberth√ºr}
\institute{Institute of Anatomy\\University of Bern\\Switzerland}
\date{September 05, 2023 | \href{https://www.ana.unibe.ch/continuing_education/comulis_training_school/}{COMULIS Training School -- Imaging Accross Scales}}

%\includeonlyframes{current}
%then....
%\begin{frame}[label=current]
%\end{frame}

% Some often used abbreviations/commands
\newcommand{\everyframe}{100}% use only every nth frame for the animations
\newcommand{\imagewidth}{\linewidth}% set global image width
\newcommand{\imageheight}{0.618\paperheight}% set global image height
\newlength\imagescale% needed for scalebars
\newcommand{\uct}{{\textmu}CT\xspace}% make our life easier

\usepackage[ngerman]{babel}
\usepackage[backend=biber,
	style=numeric,
	backref=true,
	url=false,
	maxnames=1,
	sorting=none]{biblatex}
\addbibresource{../../Documents/library.bib}% FastSSD, Windows or Mac works (on Linux/FastSSD we generated a 'Document' folder at the correct level and `ln -s ~/P/Documents/library.bib .` to it)
\usepackage{standalone}
\usepackage{tikz}
	\usetikzlibrary{spy}
	\usetikzlibrary{backgrounds}
	\tikzset{shadowed/.style={preaction={transform canvas={shift={(1pt,-1pt)}},draw=ubRed}}}
\usepackage{shadowtext}% for the shadowed scalebar
	\shadowoffset{1pt}
	\shadowcolor{ubRed}
\usepackage{pgfplots}
	\pgfplotsset{compat=newest}
\usepackage[detect-all=true,
	range-phrase=--,
	range-units=single,
	per-mode=symbol,
	per-symbol=/]{siunitx}
\usepackage[absolute,overlay]{textpos}%for the \source{} command
\usepackage[missing=main]{gitinfo2}% GitHub Actions don't pull in the commit hash, so we force the footer some lines down.
\usepackage{xspace}
\usepackage{ccicons}
\usepackage{animate}
\usepackage{fontawesome5}
\usepackage{lipsum}%for alignment testing
\usepackage{datetime2}
\usepackage{mathastext}

% Define complementary colors to ubRed
\definecolor{ubRedComplementary1}{HTML}{00a1e6}
\definecolor{ubRedComplementary2}{HTML}{00e645}

% change tikz font to slide font
% https://tex.stackexchange.com/a/33329/828
\usepackage[eulergreek]{sansmath}
	\pgfplotsset{tick label style = {font=\sansmath\sffamily},
		every axis label = {font=\sansmath\sffamily},
		legend style = {font=\sansmath\sffamily},
		label style = {font=\sansmath\sffamily}
		}

% Globally thicker lines in with tikz
% https://tex.stackexchange.com/a/206769/828
\tikzset{every picture/.style={thick}}

% Acknowledge images just below them
% Based on https://tex.stackexchange.com/a/282637/828
\newcommand{\source}[2]{%
	% Print out (short) link under image, with small text
	\raisebox{-1.618ex}{%
		\makebox[0pt][r]{%
			\tiny\href{http://#1}{#1} #2%
			}%
		}%
	}%
\newcommand{\sourcecite}[2]{%
	% Cite (an image from) a reference
	\raisebox{-1.618ex}{%
		\makebox[0pt][r]{%
			\tiny Aus~\cite{#1}, #2%
			}%
		}%
	}%
\newcommand{\sourcelink}[2]{%
	% Make the source command an \href{link}{text}
	\raisebox{-1.618ex}{%
		\makebox[0pt][r]{%
			\tiny\href{http://#1}{#2}%
			}%
		}%
	}%

% Define us a custom footer *with* progress bar, based on https://tex.stackexchange.com/a/59749/828
\makeatletter
\def\progressbar@progressbar{}% the progress bar
\newcount\progressbar@tmpcounta% auxiliary counter
\newcount\progressbar@tmpcountb% auxiliary counter
\newdimen\progressbar@pbht%progressbar height
\newdimen\progressbar@pbwd%progressbar width
\newdimen\progressbar@rcircle% radius for the circle
\newdimen\progressbar@tmpdim% auxiliary dimension
\progressbar@pbwd=0.85\linewidth%
\progressbar@rcircle=1.5pt%
\def\progressbar@progressbar{%
	\progressbar@tmpcounta=\insertframenumber%
	\progressbar@tmpcountb=\inserttotalframenumber%
	\progressbar@tmpdim=\progressbar@pbwd%
	\multiply\progressbar@tmpdim by \progressbar@tmpcounta%
	\divide\progressbar@tmpdim by \progressbar@tmpcountb%
	\par%
		\mode<beamer>{%
			\begin{tikzpicture}%
				\draw[ubGrey] (0,0) -- ++ (\progressbar@pbwd,0);%
				\draw[draw=ubRed,fill=ubGrey] (\the\dimexpr\progressbar@tmpdim-\progressbar@rcircle\relax,.5\progressbar@pbht) circle (\progressbar@rcircle);%
			\end{tikzpicture}%
			\hfill%
			bit.ly/SHTuCT\xspace|\xspace v.\xspace\href{https://github.com/habi/Talk.2023.SHTSymposium/commit/\gitHash}{\gitAbbrevHash}\xspace|\xspace\insertframenumber/\inserttotalframenumber%
			}%
		\mode<handout>{%
			bit.ly/SHTuCT\hfill|\hfill%
			Handout: Created on \DTMnow\hfill|\hfill%
			\insertframenumber/\inserttotalframenumber%
			}%
		\vspace{0.5ex}%
}
\addtobeamertemplate{footline}{}%
{%
	\begin{beamercolorbox}[wd=\paperwidth,center]{white}%
		\progressbar@progressbar%
	\end{beamercolorbox}%
}%
\makeatother

% Format bibliography for beamer
% http://tex.stackexchange.com/a/10686/828
\renewbibmacro{in:}{}
% http://tex.stackexchange.com/a/13076/828
\AtEveryBibitem{%
	\clearfield{journaltitle}
	\clearfield{pages}
	\clearfield{volume}
	\clearfield{number}
	\clearname{editor}
	\clearfield{issn}
	\clearfield{year}
}
% No parentheses around the (now empty) year: https://tex.stackexchange.com/a/147537/828
\renewcommand{\bibopenparen}{\addcomma\addspace}
\renewcommand{\bibcloseparen}{\addcomma\addspace}

% Redefine \footcite based on https://tex.stackexchange.com/a/453528/828
\DeclareCiteCommand{\footcite}[\mkbibfootnote]{%
	\usebibmacro{prenote}}{%
		\printnames[family-given]{labelname}%
		\newunit%
		\printfield{doi}%
		\newunit%
		\printlabeldateextra%
	}{\addsemicolon\space}{%
		\usebibmacro{postnote}%
	}%

% Needed for non-flashing movies: https://tex.stackexchange.com/a/649450/828
\def\zeropad#1#2{%
  \ifnum1#2<1#1
    \zeropad{#1}{0#2}%
  \else%
    #2%
  \fi%
}

% Move the text down a bit
% THIS IS A BIG HACK, IT SHOULD BE FIXED IN THE TEMPLATE
\addtobeamertemplate{frametitle}{}{\vspace*{0.75em}}

\begin{document}
% No footline on the title page
% http://tex.stackexchange.com/a/18829/828 helps us to achieve that
{%
	\setbeamertemplate{footline}{}%
	\begin{frame}%
		\maketitle
	\end{frame}%
}

\section{Introduction}
\begin{frame}
	\begin{itemize}
		\item Who are we
		\item What do we do
		\item What do I show?
		\begin{itemize}
			\item \uct
			\item Data wrangling
			\item Example of cichlids and/or teeth
		\end{itemize}
	\end{itemize}
\end{frame}

\section{(Micro-)Tomography}
\begin{frame}
	\begin{itemize}
		\item History
		\item Overview
		\item Applications (c.f. Stefan Handschuh)
		\item Some relevant stuff from the \uct-lecture, hinting at staining \emph{et al.}
	\end{itemize}
\end{frame}

\section{Data wrangling by example}
\begin{frame}
	\begin{itemize}
		\item Cichlids
		\item Image processing
		\item Python/Jupyter
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Data wrangling by example}
	\centering
	\includegraphics<1>[height=\imageheight]{./images/cichlids/Otolither_104016_head_01_Overview}%
	\includegraphics<2>[height=\imageheight]{./images/cichlids/Otolither_104016_head_02_GrayValues}%
	\includegraphics<3>[height=\imageheight]{./images/cichlids/Otolither_104016_head_03_GrayValuesRegion}%
	\includegraphics<4>[height=\imageheight]{./images/cichlids/Otolither_104016_head_04_GrayValuesSmoothed}%
	\includegraphics<5>[height=\imageheight]{./images/cichlids/Otolither_104016_head_05_Peaks}%
	\includegraphics<6>[height=\imageheight]{./images/cichlids/Otolither_104016_head_06_Peaks_All}%
	\includegraphics<7>[height=\imageheight]{./images/cichlids/Otolither_104016_head_07_ExtractedRegions}%
	\includegraphics<8>[height=\imageheight]{./images/cichlids/Otolither_104016_head_08_ExtractedRegionsMIPs}%
	\includegraphics<9>[height=\imageheight]{./images/cichlids/Otolither_104016_head_09_ExtractedOtolithMasked}%
	\only<10>{\href{file:///./images/cichlids/Otolither\_104016\_head\_3D.html}{Exported 3D view}}%
\end{frame}

\section{Take home message}
\begin{frame}
	\begin{itemize}
		\item Ask me anything
		\item Let's do this in the \emph{Hands-on} session
	\end{itemize}
\end{frame}

\begin{frame}[allowframebreaks]
	\frametitle{References}%
	\renewcommand*{\bibfont}{\scriptsize}%
	\setbeamertemplate{bibliography item}{\insertbiblabel}%
	\printbibliography%
\end{frame}

\end{document}
